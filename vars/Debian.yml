---

# https://gist.github.com/Telling/7fd4bc5ee4caaff88f4b

packages_dependencies:
  - openssh-server
  - exim4
packages_to_install:
  - fail2ban

ssh_service: ssh

fail2ban_jail_local:
  - name: default
    file: "/etc/fail2ban/jail.local"
    section: DEFAULT
    options:
      - { option: 'bantime', value: '3600' }
      - { option: 'sender', value: 'fail2ban@example.com' }
      - { option: 'destemail', value: 'root' }
      - { option: 'action', value: '%(action_mwl)s' }
      - { option: 'banaction', value: 'ufw' }
      - { option: 'mta', value: 'sendmail' }
      - { option: 'backend', value: 'auto' }
  - name: sshd
    file: "/etc/fail2ban/jail.local"
    section: sshd
    options:
      - { option: 'enabled', value: 'true' }
      # - name: ufw
      #   file: "/etc/fail2ban/action.d/ufw.conf"
      #   section: Definition
      #   options:
      #     - { option: 'actionban', value: 'ufw insert 1 deny from <ip> to any' }
      #     - { option: 'actionunban', value: 'ufw delete deny from <ip> to any' }

services_to_manage:
  - '{{ ssh_service }}'
  - fail2ban
